<div class="profile-container">
  <div class="profile-content">
    <!-- R-0006: Profile Icon, User Information, Sign Out Button -->
    <div class="profile-header">
      <div class="profile-icon-section" 
           (mouseenter)="isEditingIcon ? null : startEditIcon()"
           [class.editing]="isEditingIcon">
        <img 
          [src]="user?.profileIcon || '/assets/default-avatar.svg'" 
          alt="Profile" 
          class="profile-icon">
        
        <!-- R-0014: Show edit option on hover -->
        <div class="icon-edit-overlay" *ngIf="!isEditingIcon">
          <span>Edit Icon</span>
        </div>

        <!-- R-0014, R-0015: Icon selector modal -->
        <div class="icon-selector" *ngIf="isEditingIcon">
          <h3>Choose Profile Icon</h3>
          <div class="icon-grid">
            <div *ngFor="let icon of availableIcons" 
                 class="icon-option"
                 [class.selected]="icon === selectedIcon"
                 (click)="selectedIcon = icon">
              <img [src]="icon" alt="Icon option">
            </div>
          </div>
          <div class="icon-actions">
            <button (click)="saveIconChange()" class="btn btn-primary">Save</button>
            <button (click)="cancelIconEdit()" class="btn btn-secondary">Cancel</button>
          </div>
        </div>
      </div>

      <div class="profile-info">
        <h1 class="profile-name">{{ user?.firstName || user?.username }}</h1>
        <p class="profile-username">{{ user?.username }}</p>
        <p class="profile-email">{{ user?.email }}</p>
      </div>

      <button (click)="authService.logout()" class="btn btn-signout">
        Sign Out
      </button>
    </div>

    <!-- R-0012, R-0013: Account Information Editor -->
    <div class="profile-section">
      <div class="section-header">
        <h2>Account Information</h2>
        <button *ngIf="!isEditingAccount" 
                (click)="startEditAccount()" 
                class="btn btn-edit">
          Change Info
        </button>
      </div>

      <div *ngIf="!isEditingAccount" class="info-display">
        <div class="info-item">
          <span class="info-label">First Name:</span>
          <span class="info-value">{{ user?.firstName || 'Not set' }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Last Name:</span>
          <span class="info-value">{{ user?.lastName || 'Not set' }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Email:</span>
          <span class="info-value">{{ user?.email }}</span>
        </div>
      </div>

      <div *ngIf="isEditingAccount" class="edit-form">
        <div class="form-group">
          <label>First Name</label>
          <input type="text" [(ngModel)]="editFirstName" placeholder="First name">
        </div>
        <div class="form-group">
          <label>Last Name</label>
          <input type="text" [(ngModel)]="editLastName" placeholder="Last name">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" [(ngModel)]="editEmail" placeholder="Email">
        </div>
        <div class="form-actions">
          <button (click)="saveAccountChanges()" class="btn btn-primary">Save</button>
          <button (click)="cancelAccountEdit()" class="btn btn-secondary">Undo</button>
        </div>
      </div>
    </div>

    <!-- R-0006: Current Rosters Section -->
    <div class="profile-section">
      <div class="section-header">
        <h2>My Rosters</h2>
      </div>

      <div class="rosters-grid" *ngIf="!isEditingRoster">
        <div *ngFor="let roster of rosters" class="roster-card">
          <h3>{{ getRosterName(roster) }}</h3>
          <p class="roster-format">{{ getLeagueFormat(roster) }}</p>
          <!-- R-0009: Update roster button -->
          <button (click)="startEditRoster(roster)" class="btn btn-edit-roster">
            Edit Roster
          </button>
        </div>

        <div class="roster-card add-roster" *ngIf="rosters.length < 5">
          <span class="add-icon">+</span>
          <p>Add New Roster</p>
          <p class="roster-limit">{{ rosters.length }}/5 rosters</p>
        </div>
      </div>

      <!-- R-0010, R-0011: Edit Roster Mode -->
      <div class="roster-editor" *ngIf="isEditingRoster && selectedRoster">
        <h3>Editing: {{ getRosterName(selectedRoster) }}</h3>
        
        <div class="roster-editor-content">
          <div class="current-players">
            <h4>Current Players</h4>
            <div *ngIf="rosterPlayers.length === 0" class="empty-state">
              No players in roster yet
            </div>
            <div *ngFor="let player of rosterPlayers" class="player-item">
              <div class="player-details">
                <span class="player-name">{{ getPlayerName(player) }}</span>
                <span class="player-position">{{ player.position }} - {{ getTeamName(player) }}</span>
              </div>
              <button (click)="removePlayerFromRoster(player)" class="btn-remove">âœ•</button>
            </div>
          </div>

          <div class="player-search">
            <h4>Add Players</h4>
            <div class="search-input-wrapper">
              <input 
                type="text" 
                [(ngModel)]="playerSearchQuery"
                (input)="searchPlayers()"
                placeholder="Search players..."
                class="search-input">
              <span *ngIf="isSearching" class="searching">Searching...</span>
            </div>

            <div class="search-results" *ngIf="searchResults.length > 0">
              <div *ngFor="let player of searchResults" 
                   class="search-result-item"
                   (click)="addPlayerToRoster(player)">
                <div class="player-details">
                  <span class="player-name">{{ getPlayerName(player) }}</span>
                  <span class="player-position">{{ player.position }} - {{ getTeamName(player) }}</span>
                </div>
                <button class="btn-add">Add</button>
              </div>
            </div>
          </div>
        </div>

        <!-- R-0011: Save button -->
        <div class="roster-editor-actions">
          <button (click)="saveRosterChanges()" class="btn btn-primary">
            Save Changes
          </button>
        </div>
      </div>
    </div>
  </div>
</div>